

http {
    #access_log /dev/tty;
    #error_log stderr debug;
    #rewrite_log on;

	server {
	    listen 8091;
	    return 200 "the app:  you asked for $uri";
        }

	server {
	    listen 8090;
	    root /home/dav/work/nginx.test/;

	    location /uploads/ {
		error_page 404 = @app;
		log_not_found off;
		set $try_uri $uri;
		set $dir $uri;
		if ( $uri ~ ^(.*/) ) {
		    set $dir $1;
	            #return 200 "dir =  $dir";
		}
	            #return 200 "dir =  $dir";
		#if ( -d $document_root/$dir ) { 
	            #return 200 "dir =  $dir -- exists";
		#}
		if ( -f $document_root/$dir/.wgaccess ) { 
		    return 404;
	            #set $try_uri 'not a valid file';
	            #return 200 "try_uri =  $try_uri";
		}
	            #return 200 "try_uri =  $try_uri";
		try_files "$try_uri" @app;
	    }

	    location / {
		try_files extras/www/$uri @app;
	    }

	    location @app {
		proxy_pass http://localhost:8091;
	    }

	}

}

events {

}


